<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <!--Edit the title of the page-->
    <title>eBird Explorer</title>
    <!-- Stylesheets -->
    <link rel="stylesheet" href="http://cdn.leafletjs.com/leaflet-0.7.3/leaflet.css" />
    <link rel="stylesheet" href="http://libs.cartocdn.com/cartodb.js/v3/3.11/themes/css/cartodb.css" />
    <link rel="stylesheet" href="style.css">
</head>

<body>

    <!-- Header -->
    <div id="header">
        <div id="title"><h1>eBird Explorer</h1></div>
        <div id="nav">
            <ul>
                <li>How it Works</li>
                <li>Why Explore</li>
                <li>About eBird</li>
            </ul>
        </div>
    </div>

    <!-- Map -->
    <div id="map"></div>

    <!-- Legend -->
 <!--    <div class='cartodb-legend choropleth'> 
        <div class="legend-title">eBird Data Coverage</div>
        <ul>
            <li class="min">Poor</li>
            <li class="min">Moderate</li>
            <li class="min">Good</li>
            <li class="graph count_189">
                <div class="colors">
                    <div class="quartile" style="background-color:#B81609"></div>
                    <div class="quartile" style="background-color:#FF6600"></div>
                    <div class="quartile" style="background-color:#FFFFFF"></div>
                </div>
            </li>
        </ul>
    </div> -->

    <div id="layer-filter">
        <ul>
            <li data="0" class="selected">All</li>
            <li data="0.00001">Poor</li>
            <li data="0.00005">Moderate</li>
            <li data="10">Good</li>
        </ul>
    </div>

    <!-- JavaScript Section-->
    <script src="http://cdn.leafletjs.com/leaflet-0.7.3/leaflet.js"></script>
    <script type="text/javascript" src="http://maps.stamen.com/js/tile.stamen.js?v1.3.0"></script>
    <script src="http://libs.cartocdn.com/cartodb.js/v3/3.11/cartodb.js"></script>

    <script type="text/javascript">

        //LEAFLET STAMEN BASEMAP
        // var map = new L.map('map').setView([40,-98], 4);

        // var layer = new L.StamenTileLayer("toner-lite");
        // map.addLayer(layer);

        // CARTODB EASY MAP
        // get the viz.json url from the CartoDB Editor
        // - click on visualize
        // - create new visualization
        // - make visualization public
        // - click on publish
        // - go to API tab
        // window.onload = function() {
        //   cartodb.createVis('map', 'http://mtaylorlong.cartodb.com/api/v2/viz/81f31a2a-8021-11e4-8fc1-0e4fddd5de28/viz.json', {
        //         cartodb_logo: false
        //   });
        // }

        // create layer selector
        function createSelector(layer) {
            var sql = new cartodb.SQL({ user: 'mtaylorlong' });
            var $options = $('#layer-filter li');
           
            $options.click(function(e) {
                // get the area of the selected layer
                var $li = $(e.target);
                var limit = $li.attr('data');
            
                // deselect all and select the clicked one
                $options.removeClass('selected');
                $li.addClass('selected');
            
                // create query based on data from the layer
                var query = "select * from county";
                if(limit !== '0') {
                    query = "select * from county where list_km <= " + limit;
                }
                // change the query in the layer to update the map
                layer.setSQL(query);
                });
        }

        function main() {
        cartodb.createVis('map', 'http://mtaylorlong.cartodb.com/api/v2/viz/81f31a2a-8021-11e4-8fc1-0e4fddd5de28/viz.json', {
            tiles_loader: true,
            center_lat: 40,
            center_lon: -98,
            zoom: 4
        })
        .done(function(vis, layers) {
            // layer 0 is the base layer, layer 1 is cartodb layer
            var subLayer = layers[1].getSubLayer(0);
            createSelector(subLayer);
        })
        .error(function(err) {
            console.log(err);
            });
      }
      window.onload = main;

    </script>

</body>
</html>